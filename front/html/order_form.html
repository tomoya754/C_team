<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>注文書（A4）</title>
    <link rel="stylesheet" href="../css/sidebar.css">
    <link rel="stylesheet" href="../css/order_form.css">
</head>
<body>
    <!-- ハンバーガーメニューボタン -->
    <div class="menu-btn" id="menuBtn" style="display:block; position:fixed; top:20px; left:20px; z-index:1001;">&#9776;</div>
    <!-- サイドバー背景（モーダル用） -->
    <div class="sidebar-bg" id="sidebarBg"></div>
    <!-- サイドバー -->
    <nav class="sidebar" id="sidebar">
        <span class="sidebar-close" id="sidebarClose" style="display:none; position:fixed; top:20px; left:20px; z-index:1002; font-size:2em; cursor:pointer;">&times;</span>
        <ul>
            <li><a href="/">・<u>HOME</u></a></li>
            <li><a href="/html/order_list.html">・注文書一覧</a></li>
            <li><a href="/html/delivery_list.html">・納品書一覧</a></li>
            <li><a href="/html/statistics_list.html">・統計情報一覧</a></li>
            <li><a href="/html/customer_register.html">・顧客情報登録</a></li>
        </ul>
    </nav>
    <!-- メインコンテンツ -->
    <div class="main" id="main">
        <!-- A4注文書本体 -->
        <div class="a4-sheet">
            <h1 class="order-title" style="text-align:center;letter-spacing:0.3em;font-size:2.1em;margin-bottom:32px;">注文書</h1>
            <div style="display:flex;flex-direction:row;justify-content:space-between;align-items:flex-start;gap:40px;">
                <!-- 左側：顧客情報 -->
                <div style="flex:1;min-width:340px;max-width:420px;">
                    <div style="margin-bottom:12px;">
                        <span style="font-size:1.1em;">顧客ID：</span>
                        <input type="text" class="input-meta" style="width:220px;border:none;border-bottom:2px solid #222;font-size:1.1em;vertical-align:middle;">
                    </div>
                    <div style="margin-bottom:8px;">
                        <input type="text" class="input-meta" style="width:220px;font-size:1.3em;text-align:center;border:none;background:transparent;letter-spacing:0.3em;" placeholder="○○○○○○○○○○"> 様
                    </div>
                    <div style="margin-bottom:8px;color:#666;font-size:0.95em;">（お客様住所）</div>
                    <div style="margin-bottom:32px;">
                        <textarea class="input-meta" style="width:100%;height:38px;resize:none;border:none;border-bottom:1px dotted #888;"></textarea>
                    </div>
                    <div style="border-bottom:1px dotted #888;height:18px;margin-bottom:32px;"></div>
                    <div style="display:flex;align-items:center;margin-top:32px;">
                        <span style="font-size:1.1em;">合計金額：</span>
                        <span style="font-size:2em;color:#222;font-weight:bold;margin:0 12px;">￥<span id="totalAmount">0</span></span>
                        <span style="font-size:1em;color:#666;">(税込)</span>
                    </div>
                </div>
                <!-- 右側：発注情報 -->
                <div style="flex:1;min-width:320px;max-width:400px;">
                    <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                        <span style="font-size:1.1em;">注文書No.</span>
                        <input type="text" class="input-meta" style="width:160px;text-align:right;border:none;font-size:1.1em;" placeholder="XXXXXXXXXX">
                    </div>
                    <div style="display:flex;justify-content:space-between;margin-bottom:18px;">
                        <span style="font-size:1.1em;">注文日：</span>
                        <input type="date" class="input-meta" style="width:160px;text-align:right;border:none;font-size:1.1em;">
                    </div>
                    <div style="font-weight:bold;font-size:1.1em;margin-bottom:2px;">緑橋書店</div>
                    <div style="margin-bottom:2px;">〒537-0022</div>
                    <div style="margin-bottom:2px;">大阪府大阪市東成区</div>
                    <div style="margin-bottom:2px;">中本１丁目５－２１</div>
                    <div style="margin-bottom:2px;">TEL：00-0000-0000</div>
                    <div style="margin-bottom:2px;">FAX：00-0000-0000</div>
                    <div style="margin-bottom:2px;">E-Mail xxxxxxxxxxxxxxxxxxxxxxxx</div>
                    <div style="margin-bottom:2px;">担当者 ○○○○○</div>
                </div>
            </div>
            <table class="order-table">
                <tr>
                    <th>No.</th>
                    <th>署名</th>
                    <th>数量</th>
                    <th>単価</th>
                    <th>金額</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td><input type="text" name="item1"></td>
                    <td><input type="number" name="qty1"></td>
                    <td><input type="number" name="price1"></td>
                    <td><input type="number" name="amount1"></td>
                </tr>
                <tr>
                    <td>2</td>
                    <td><input type="text" name="item2"></td>
                    <td><input type="number" name="qty2"></td>
                    <td><input type="number" name="price2"></td>
                    <td><input type="number" name="amount2"></td>
                </tr>
                <tr>
                    <td>3</td>
                    <td><input type="text" name="item3"></td>
                    <td><input type="number" name="qty3"></td>
                    <td><input type="number" name="price3"></td>
                    <td><input type="number" name="amount3"></td>
                </tr>
                <tr>
                    <td>4</td>
                    <td><input type="text" name="item4"></td>
                    <td><input type="number" name="qty4"></td>
                    <td><input type="number" name="price4"></td>
                    <td><input type="number" name="amount4"></td>
                </tr>
                <tr>
                    <td>5</td>
                    <td><input type="text" name="item5"></td>
                    <td><input type="number" name="qty5"></td>
                    <td><input type="number" name="price5"></td>
                    <td><input type="number" name="amount5"></td>
                </tr>
                <tr>
                    <td>6</td>
                    <td><input type="text" name="item6"></td>
                    <td><input type="number" name="qty6"></td>
                    <td><input type="number" name="price6"></td>
                    <td><input type="number" name="amount6"></td>
                </tr>
                <tr>
                    <td>7</td>
                    <td><input type="text" name="item7"></td>
                    <td><input type="number" name="qty7"></td>
                    <td><input type="number" name="price7"></td>
                    <td><input type="number" name="amount7"></td>
                </tr>
                <tr>
                    <td>8</td>
                    <td><input type="text" name="item8"></td>
                    <td><input type="number" name="qty8"></td>
                    <td><input type="number" name="price8"></td>
                    <td><input type="number" name="amount8"></td>
                </tr>
                <tr>
                    <td>9</td>
                    <td><input type="text" name="item9"></td>
                    <td><input type="number" name="qty9"></td>
                    <td><input type="number" name="price9"></td>
                    <td><input type="number" name="amount9"></td>
                </tr>
                <tr>
                    <td>10</td>
                    <td><input type="text" name="item10"></td>
                    <td><input type="number" name="qty10"></td>
                    <td><input type="number" name="price10"></td>
                    <td><input type="number" name="amount10"></td>
                </tr>
                <tr>
                    <td>11</td>
                    <td><input type="text" name="item11"></td>
                    <td><input type="number" name="qty11"></td>
                    <td><input type="number" name="price11"></td>
                    <td><input type="number" name="amount11"></td>
                </tr>
                <tr>
                    <td>12</td>
                    <td><input type="text" name="item12"></td>
                    <td><input type="number" name="qty12"></td>
                    <td><input type="number" name="price12"></td>
                    <td><input type="number" name="amount12"></td>
                </tr>
                <tr>
                    <td colspan="4" class="right">小計</td>
                    <td><input type="number" class="input-total"></td>
                </tr>
                <tr>
                    <td colspan="4" class="right">消費税</td>
                    <td><input type="number" class="input-total"></td>
                </tr>
                <tr>
                    <td colspan="4" class="right">合計金額</td>
                    <td><input type="number" class="input-total"></td>
                </tr>
            </table>
            <div class="order-remark-row">
                <div style="font-size:16px;">備考：</div>
                <textarea class="input-meta" style="width:90%;height:40px;resize:none;"></textarea>
            </div>
            <div class="btn-area">
                <button type="button" class="btn" id="saveBtn">保存</button>
                <button type="button" class="btn" onclick="window.print()">印刷</button>
            </div>
        </div>
    </div>
    <script src="../js/order_form.js"></script>
    <script>
    // サイドバー開閉
    const menuBtn = document.getElementById('menuBtn');
    const sidebar = document.getElementById('sidebar');
    const sidebarBg = document.getElementById('sidebarBg');
    const sidebarClose = document.getElementById('sidebarClose');
    function openSidebar() {
        sidebar.classList.add('open');
        sidebarBg.classList.add('show');
        menuBtn.style.display = 'none';
        sidebarClose.style.display = 'block';
    }
    function closeSidebar() {
        sidebar.classList.remove('open');
        sidebarBg.classList.remove('show');
        menuBtn.style.display = 'block';
        sidebarClose.style.display = 'none';
    }
    menuBtn.onclick = openSidebar;
    sidebarClose.onclick = closeSidebar;
    sidebarBg.onclick = closeSidebar;

    // 保存ボタンでAPIに注文書を登録
    document.getElementById('saveBtn').onclick = async function() {
        // 入力値の取得
        const customerId = document.querySelector('input[placeholder="宛先名"]').value || '未設定';
        const customerName = document.querySelector('input[placeholder="会社名"]').value || '未設定';
        const orderDetail = document.querySelector('input[name^="item"]').value || '未設定';
        const orderDate = document.querySelector('input[type="date"]').value || '';
        const phone = document.querySelector('input[placeholder="電話番号"]').value || '';
        const note = document.querySelector('.note-area textarea').value || '';

        // 必須項目のバリデーション
        if (!customerId || !customerName || !orderDetail || !orderDate) {
            alert('必須項目が不足しています');
            return;
        }

        // APIへ注文書データをPOST送信
        const res = await fetch('http://localhost:3000/api/orders', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                customerId,
                customerName,
                orderDetail,
                orderDate,
                phone,
                note
            })
        });
        if (res.ok) {
            alert('注文書を登録しました');
            // 登録後、一覧画面へ遷移
            location.href = 'order_list.html';
        } else {
            const err = await res.json();
            alert('エラー: ' + err.error);
        }
    };
    </script>
</body>
</html>